const { Client, GatewayIntentBits, EmbedBuilder } = require('discord.js');
const cron = require('node-cron');
const http = require('http');

const client = new Client({
  intents: [
    GatewayIntentBits.Guilds,
    GatewayIntentBits.GuildMessages,
    GatewayIntentBits.MessageContent
  ]
});

// âœ… ì„¤ì •ê°’ (ë°˜ë“œì‹œ ì±„ìš°ì„¸ìš”)
const CHANNEL_ID = "1473382815897747507";           // ì§ˆë¬¸ì„ ì˜¬ë¦´ ì±„ë„ ID
const USER_IDS = ["926457972538871880", "560466004858372096"];        // ë‘ ì‚¬ëŒì˜ ìœ ì € ID (ê°œë°œìëª¨ë“œë¡œ ë³µì‚¬í•´ì„œ ë„£ê¸°)

const questions = [
  //í•˜ë£¨ Â· ê°ì • Â· ì¼ìƒ ê³µìœ í˜•
"ì˜¤ëŠ˜ í•˜ë£¨ ì¤‘ ì œì¼ ê¸°ë¶„ ì¢‹ì•˜ë˜ ìˆœê°„ì€?",
"ìš”ì¦˜ ì œì¼ ë§ì´ ìƒê°ë‚˜ëŠ” ê±´ ë­ì•¼?",
"ì˜¤ëŠ˜ í•˜ë£¨ ì ìˆ˜ëŠ” 10ì  ë§Œì ì— ëª‡ ì ?",
"ì˜¤ëŠ˜ í•˜ë£¨ì— ì ìˆ˜ ì¤€ë‹¤ë©´ ëª‡ ì ?",
"ìš”ì¦˜ ì œì¼ ìì£¼ ë“£ëŠ” ë…¸ë˜ ë­ì•¼?",
"ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ì„ ë•Œ ì–´ë–»ê²Œ í’€ì–´?",
"ìš”ì¦˜ ë¹ ì ¸ìˆëŠ” ê±° ìˆì–´?",
"ìµœê·¼ì— ì œì¼ ë§ì´ ì›ƒì€ ìˆœê°„ì€?",
"ì§‘ì—ì„œ ì œì¼ ì¢‹ì•„í•˜ëŠ” ì‹œê°„ëŒ€ëŠ”?",
"ìš”ì¦˜ ê°€ì¥ ë¨¹ê³  ì‹¶ì€ ìŒì‹ì€?",
"ì§€ê¸ˆ ê¸°ë¶„ í•œ ë‹¨ì–´ë¡œ í‘œí˜„í•˜ë©´?",
"ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ê³„ì ˆì€?",
"ìš”ì¦˜ ìì£¼ ìƒê°ë‚˜ëŠ” ì¥ì†Œ ìˆì–´?",
"ê°€ë” í˜¼ì ìˆì„ ë•Œ ë¬´ìŠ¨ ìƒê°í•´?",
"ìš”ì¦˜ ì œì¼ ë§ì´ ìƒê°í•˜ëŠ” ì£¼ì œëŠ”?",
"ìš”ì¦˜ ì™¸ë¡­ë‹¤ê³  ëŠë‚€ ì  ìˆì–´?",
"ë„ˆí•œí…Œ ìœ„ë¡œê°€ ë˜ëŠ” ë§ì€ ë­ì•¼?",
"ìš”ì¦˜ ì œì¼ ë“£ê³  ì‹¶ì€ í•œë§ˆë””ëŠ”?",
"ì˜¤ëŠ˜ ê°€ì¥ ì›ƒê²¼ë˜ ì¼ ë­ì˜€ì–´?",
"ì˜¤ëŠ˜ í•˜ë£¨ ë‚˜ë‘ ê³µìœ í•˜ê³  ì‹¶ì€ ì¼ ìˆì–´?",
"ì˜¤ëŠ˜ ê¸°ë¶„ í•œ ë‹¨ì–´ë¡œ í‘œí˜„í•˜ë©´?",
"ìš”ì¦˜ ëˆ„êµ¬ë‘ ìˆìœ¼ë©´ ì œì¼ í¸í•´?",
"ìš”ì¦˜ ì—°ë½ ì œì¼ ë§ì´ í•˜ëŠ” ì‚¬ëŒ ëˆ„êµ¬ì•¼?",
  //ë‚˜ì— ëŒ€í•œ ìƒê° Â· ì¡´ì¬ê° í™•ì¸í˜•
"ì˜¤ëŠ˜ ë‚˜ ìƒê°ë‚œ ì  ìˆì–´?",
"ë‚˜ë‘ ê³µí†µì  í•˜ë‚˜ ì°¾ìë©´ ë­ ê°™ì•„?",
"ë‚´ê°€ ìƒê°ë³´ë‹¤ ì´ëŸ° ì‚¬ëŒì´ë‹¤ ì‹¶ì€ ê±° ìˆì–´?",
"ë‚˜í•œí…Œ ê¶ê¸ˆí–ˆë˜ ê±° í•˜ë‚˜ ìˆì–´?",
"ì˜¤ëŠ˜ ë‚˜ë‘ ëŒ€í™”í•˜ë©´ì„œ ì œì¼ ì¢‹ì•˜ë˜ ìˆœê°„ì€?",
"ë‚˜ë‘ ëŒ€í™”í•  ë•Œ ì–´ë–¤ ê¸°ë¶„ ë“¤ì–´?",
"ë‚˜í•œí…Œ ì ìˆ˜ ë§¤ê¸°ë©´ ëª‡ ì  ì¤„ ê±°ì•¼?",
"ë‚´ ë§¤ë ¥ í•˜ë‚˜ë§Œ ë§í•´ì¤˜",
"ë‚˜í•œí…Œ ì œì¼ ì˜ ì–´ìš¸ë¦¬ëŠ” ë³„ëª…ì€?",
"ì†”ì§íˆ ë‚˜ ì¡°ê¸ˆì´ë¼ë„ ì‹ ê²½ ì“°ì—¬?",
"ë‚˜í•œí…Œ ë¹„ë°€ í•˜ë‚˜ ë§í•´ì¤„ ìˆ˜ ìˆì–´?",
"ë‚˜í•œí…Œ í•˜ê³  ì‹¶ì—ˆëŠ”ë° ëª» í•œ ë§ ìˆì–´?",
"ë‚˜í•œí…Œ ì²˜ìŒ ëŠë‚€ ì¸ìƒì€?",
"ë‚˜ ìƒê°ë³´ë‹¤ ê´œì°®ì€ ì‚¬ëŒ ê°™ì•„?",
"ë‚´ê°€ ìœ„ë¡œê°€ ëœ ì  ìˆì–´?",
"ë‚˜ë‘ ìˆìœ¼ë©´ ì•ˆì •ê° ë“¤ì–´?",
"ë‚´ê°€ ì—†ìœ¼ë©´ ì¡°ê¸ˆ í—ˆì „í•  ê²ƒ ê°™ì•„?",
"ë‚´ê°€ ì˜¤ëŠ˜ ì›ƒê²Œ ë§Œë“  ìˆœê°„ ìˆì–´?",
"ë‚´ê°€ ìˆìœ¼ë©´ í•˜ë£¨ê°€ ë” ì¦ê±°ì›Œ?",
"ì˜¤ëŠ˜ í•˜ë£¨ ì¤‘ ë‚˜ ìƒê°ë‚œ ìˆœê°„ ìˆì–´?",
"ë‚˜ë‘ ì˜¤ëŠ˜ ì´ì•¼ê¸°í•˜ë©´ì„œ ì¢‹ì•˜ë˜ ìˆœê°„ì€?",
"ì˜¤ëŠ˜ ë‚˜ë‘ í•¨ê»˜ í•œ ì‹œê°„ ì¤‘ ê°€ì¥ ì¢‹ì•˜ë˜ ìˆœê°„?",
"ë‚´ê°€ ì¥ë‚œì¹˜ê±°ë‚˜ ë†ë‹´í•˜ë©´ ê¸°ë¶„ì´ ë¬˜í•˜ê²Œ ë‹¬ë¼ì§€ëŠ” ì  ìˆì–´?",
"ë‚˜ì™€ ì´ì•¼ê¸°í•  ë•Œ ì›ƒìŒì´ ìì—°ìŠ¤ëŸ½ê²Œ ë‚˜ëŠ” ìˆœê°„ì´ ìˆì–´?",
"ë‚´ê°€ ì—†ëŠ” ë™ì•ˆì—ë„ ë‚˜ë¥¼ ë– ì˜¬ë¦° ì ì´ ìˆì–´?",
"ë‚´ê°€ ë³´ë‚´ëŠ” ë©”ì‹œì§€ê°€ ê¸°ë‹¤ë ¤ì§„ ì  ìˆì–´?",
"ë‚´ê°€ ì—†ëŠ” ë™ì•ˆ í•˜ë£¨ê°€ ì‹¬ì‹¬í•˜ê²Œ ëŠê»´ì§„ ì  ìˆì–´?",
"ë‚´ê°€ ì—†ì„ ë•Œ ê°€ë” ë‚˜ë¥¼ ë– ì˜¬ë¦¬ëŠ” ìˆœê°„ ìˆì–´?",
"ë‚´ê°€ ë„ˆí•œí…Œ ì–´ë–¤ ì¡´ì¬ ê°™ì•„?",
"ë‚˜í•œí…Œ ê¸°ëŒ€í•˜ëŠ” ê²Œ ìˆì–´?",
"ë‚´ê°€ ë°”ê¾¸ë©´ ì¢‹ì„ ê²ƒ ê°™ì€ ë¶€ë¶„ ìˆì–´?",
"ì†”ì§íˆ ë‚˜ë‘ ëŒ€í™”í•˜ëŠ” ê±° ê·€ì°®ì•˜ë˜ ì  ìˆì–´?",
"ë‚´ê°€ ì—°ë½ ì•ˆ í•˜ë©´ ì„œìš´í•  ê²ƒ ê°™ì•„?",
  //ê´€ê³„ ë°©í–¥ Â· ì¹œë°€ë„ íƒìƒ‰í˜•
"ë‚˜ë‘ ê°™ì´ í•´ë³´ê³  ì‹¶ì€ ê±° í•˜ë‚˜ë§Œ ë§í•´ì¤˜ ğŸ˜Œ",
"ìš”ì¦˜ ë‚˜í•œí…Œ í•˜ê³  ì‹¶ì—ˆë˜ ë§ ìˆì–´?",
"ë„ˆí•œí…Œ 'í¸í•˜ë‹¤'ëŠ” ì–´ë–¤ ì˜ë¯¸ì•¼?",
"ìš”ì¦˜ ë‚˜í•œí…Œ ìˆ¨ê¸°ê³  ìˆëŠ” ê³ ë¯¼ ìˆì–´?",
"ê°‘ìê¸° ë– ì˜¤ë¥´ëŠ” ì‚¬ëŒ ìˆì–´?",
"í˜ë“¤ ë•Œ ëˆ„ê°€ ì˜†ì— ìˆì–´ì£¼ë©´ ì¢‹ê² ì–´?",
"ë„ˆëŠ” ì‚¬ë‘í•˜ë©´ ì–´ë–¤ ìŠ¤íƒ€ì¼ ê°™ì•„?",
"ì‚¬ëŒì„ ì¢‹ì•„í•˜ê²Œ ë˜ë©´ ì œì¼ ë¨¼ì € ë³€í•˜ëŠ” ê²Œ ë­ì•¼?",
"ë‚´ê°€ í•´ì¤¬ìœ¼ë©´ í•˜ëŠ” ë§ ìˆì–´?",
"ë‚˜ë‘ ë” ê°€ê¹Œì›Œì§€ê³  ì‹¶ë‹¤ê³  ëŠë‚€ ì  ìˆì–´?",
"ë‚´ê°€ ë‹¤ë¥¸ ì‚¬ëŒì´ë‘ ì¹œí•˜ê²Œ ì§€ë‚´ë©´ ì§ˆíˆ¬ë‚˜?",
"ë‚˜ë‘ ë‹¨ë‘˜ì´ ë†€ë©´ ë­ í•˜ê³  ì‹¶ì–´?",
"ë‚´ê°€ ì‚¬ë¼ì§€ë©´ ì¡°ê¸ˆì´ë¼ë„ ì•„ì‰¬ìš¸ ê²ƒ ê°™ì•„?",
"ë‚˜ë‘ í•˜ë£¨ ì¢…ì¼ í†µí™” ê°€ëŠ¥í•´?",
"ë‚˜ë‘ ì—¬í–‰ ê°€ë©´ ì–´ë”” ê°€ê³  ì‹¶ì–´?",
"ë‚˜ë‘ ë‹¨ë‘˜ì´ ì—¬í–‰ ê°€ëŠ” ê±° ê´œì°®ì•„?",
"ë‚˜ ì›ƒê¸¸ ë•Œë‘ ì§„ì§€í•  ë•Œ ì¤‘ ë­ê°€ ë” ì¢‹ì•„?",
"ë‚˜ë‘ ë°¤ìƒˆ ëŒ€í™” ê°€ëŠ¥?",
"ë‚´ê°€ ê°‘ìê¸° ê³ ë°±í•˜ë©´ ë°˜ì‘ ì–´ë•Œ?",
"ë‚˜ë‘ ë°ì´íŠ¸ ì½”ìŠ¤ ì§œë³¸ë‹¤ë©´?",
"ë‚´ê°€ ë‹¤ë¥¸ ì‚¬ëŒì´ë‘ ë” ì¹œí•´ì§€ë©´ ì–´ë–¤ ê¸°ë¶„ì¼ ê²ƒ ê°™?",
"ë‚˜ë‘ ì‹¤ì œë¡œ ë§Œë‚˜ë©´ ì–´ìƒ‰í• ê¹Œ?",
"ìš°ë¦¬ ë‘˜ì´ ì˜ ë§ëŠ” í¸ ê°™ì•„?",
"ë‚˜ë‘ ì—°ë½ ëŠê¸°ë©´ ì•„ì‰¬ìš¸ ê²ƒ ê°™ì•„?",
"ë‚˜ë‘ ë©”ì‹œì§€ë‚˜ í†µí™”í•  ë•Œ ê¸°ë‹¤ë ¤ì§€ëŠ” ìˆœê°„ì´ ìˆì–´?",
"ì‚¬ëŒ ì¢‹ì•„í•  ë•Œ ë³´í†µ ë¨¼ì € í‘œí˜„í•˜ëŠ” í¸ì´ì•¼ ì•„ë‹ˆë©´ ê¸°ë‹¤ë¦¬ëŠ” í¸ì´ì•¼?",
"ë‚˜ë¥¼ ì´ì„±ìœ¼ë¡œ ìƒê°í•´ ë³¸ ì  ìˆì–´?",
"ë‚˜ë‘ ì§€ê¸ˆë³´ë‹¤ ë” ê°€ê¹Œì›Œì§ˆ ìš©ê¸° ìˆì–´?",
"ë‚˜ë‘ ë‹¨ë‘˜ì´ ì–´ë”” ê°€ëŠ” ê±° ìƒìƒí•´ ë³¸ ì  ìˆì–´?",
"ë‚˜ë‘ í•´ë³¼ë˜ ë§ë˜",
"ë‚˜ë‘ í•˜ë£¨ ë°”ê¿” ì‚´ë©´ í•´ë³´ê³  ì‹¶ì€ ê±´?",
"ë‚˜ë‘ í•´ë³´ê³  ì‹¶ì€ ì†Œì†Œí•œ ë²„í‚·ë¦¬ìŠ¤íŠ¸ í•˜ë‚˜ë§Œ ë§í•´ì¤˜",
"ë‚˜ë‘ ë” ê¹Šì€ ì–˜ê¸°í•´ë³´ê³  ì‹¶ì–´?",
"ë‚˜ë‘ ì‚¬ì†Œí•œ ë‹¤íˆ¼ ìƒê¸°ë©´?",
"ë‚´ê°€ ë³´ê³  ì‹¶ë‹¤ê³  í•˜ë©´?",
"ë‚˜ë‘ ì‚¬ê·€ë©´ ê°€ì¥ ê±±ì •ë˜ëŠ” ê±´?",
"ë‚˜ë¥¼ ì¹œêµ¬ë¼ê³ ë§Œ ìƒê°í•´?",
"ë‚˜ë¥¼ ì‹¤ì œë¡œ ë§Œë³¼ ìƒê° ìˆì–´?",
  //ì§ì„¤ì  ê°ì • í™•ì¸ Â· ê³ ë°± ì••ë°•í˜•
"ë‚˜ ì¢‹ì•„í•´?",
"ë‚´ê°€ ì¢‹ì•„í•œë‹¤ê³  í•˜ë©´ ë¶€ë‹´ì´ì•¼?",
"ë‚´ê°€ ì§ˆíˆ¬í•˜ë©´ ê·€ì—¬ìš¸ ê²ƒ ê°™ì•„?",
"ë‚´ê°€ ê³ ë°±í•˜ë©´ ë°›ì•„ì¤„ ê°€ëŠ¥ì„±ì€?",
"ì†”ì§íˆ ë‚˜í•œí…Œ ê°ì • ìˆì–´ ì—†ì–´ìš” ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ë§í•´ì¤˜",
"ë‚˜ë¥¼ ì¢‹ì•„í•˜ë ¤ë‹¤ ì°¸ëŠ” ëŠë‚Œì´ì•¼ ì•„ë‹ˆë©´ ì• ì´ˆì— ê°ì •ì´ ì—†ì–´?",
"ë‚´ê°€ ê³ ë°±í•˜ë©´ ê³ ë¯¼ì€ í•  ê±°ì•¼ ì•„ë‹ˆë©´ ë°”ë¡œ ê±°ì ˆí•  ê±°ì•¼?",
  //ì‹ ì²´ì  ìƒìƒ Â· ìŠ¤í‚¨ì‹­ ìˆ˜ìœ„í˜•
"ë‚˜í•œí…Œ ì„¤ë Œ ì  ìˆì–´?",
"ë‚˜ë‘ ìŠ¤í‚¨ì‹­ ê°€ëŠ¥í•˜ë‹¤ë©´ ì–´ë””ê¹Œì§€ ê´œì°®ì•„?",
"ë‚˜ë‘ ë‘˜ì´ ì¹¨ëŒ€ì— ìˆìœ¼ë©´ ì•„ë¬´ ì¼ë„ ì•ˆ ìƒê¸¸ ìì‹  ìˆì–´?",
"ë‚´ê°€ ê°‘ìê¸° ì† ì¡ìœ¼ë©´ ëº„ ê±°ì•¼?",
"ë‚˜ë‘ í¬ì˜¹í•˜ë©´ ëª‡ ì´ˆ ë²„í‹¸ ìˆ˜ ìˆì–´?",
"ë‚˜ë¥¼ ì•ˆì•„ë³´ê³  ì‹¶ë‹¤ëŠ” ìƒê° í•´ë´¤ì–´?",
"ë‚˜ë¥¼ ë³´ë©´ ëˆˆ ì–´ë””ë¶€í„° ë³¼ ê²ƒ ê°™ì•„?",

];

let shuffledQuestions = [];
let currentIndex = 0;

function shuffleArray(array) {
  return array.sort(() => Math.random() - 0.5);
}

function getNextQuestion() {
  if (currentIndex >= shuffledQuestions.length) {
    shuffledQuestions = shuffleArray([...questions]);
    currentIndex = 0;
  }
  return shuffledQuestions[currentIndex++];
}

// âœ… ì˜¤ëŠ˜ ì§ˆë¬¸ ìƒíƒœ (ë‘˜ ë‹¤ ë‹µí•˜ê¸° ì „ê¹Œì§€ ë‹µ ìˆ¨ê¹€)
let activeQuestion = null;
// activeQuestion = { question: string, answers: { [userId]: string } }

async function postQuestion() {
  const channel = client.channels.cache.get(CHANNEL_ID);
  if (!channel) return;

  const question = getNextQuestion();
  activeQuestion = { question, answers: {} };

  const embed = new EmbedBuilder()
    .setColor(0xFF69B4)
    .setAuthor({
      name: `${channel.guild.name} ì˜¤ëŠ˜ì˜ ì§ˆë¬¸ ğŸŒ™`,
      iconURL: channel.guild.iconURL({ dynamic: true })
    })
    .setDescription(`ğŸ’Œ ${question}`)
    .setFooter({ text: "ë§¤ì¼ ë°¤ ìš°ë¦¬ë§Œì˜ ì§ˆë¬¸ ğŸ’«" })
    .setTimestamp();

  await channel.send({ embeds: [embed] });
}

//ë‹µë³€ ê³µê°œ
async function revealAnswers(channel) {
  const [u1, u2] = USER_IDS;
  const a1 = activeQuestion.answers[u1];
  const a2 = activeQuestion.answers[u2];

  const embed = new EmbedBuilder()
    .setColor(0x2C2F33)
    .setTitle("ğŸŒ™ ì˜¤ëŠ˜ì˜ ì§ˆë¬¸ - ë‹µë³€ ê³µê°œ")
      .setDescription(
    [
      "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
      `ğŸ’Œ  **${activeQuestion.question}**`,
      "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
    ].join("\n")
  )
  .addFields(
    { name: `ğŸŒ™ <@${u1}>`, value: `> ${a1}` },
    { name: `âœ¨ <@${u2}>`, value: `> ${a2}` }

    )
    .setTimestamp();

  await channel.send({ embeds: [embed] });
  activeQuestion = null;
}

client.once('ready', () => {
  console.log('ë´‡ ì‹¤í–‰ë¨');

  // ë§¤ì¼ 22ì‹œ(ì„œìš¸ì‹œê°„) ìë™ ì§ˆë¬¸
  cron.schedule('0 22 * * *', async () => {
    await postQuestion();
  }, { timezone: 'Asia/Seoul' });
});

// ë©”ì‹œì§€ ì²˜ë¦¬
client.on('messageCreate', async (message) => {
  if (message.author.bot) return;

  // ìˆ˜ë™ ì§ˆë¬¸ (!ì§ˆë¬¸)
  if (message.content === '!ì§ˆë¬¸') {
    // ì§€ì •ëœ ì±„ë„ì—ì„œë§Œ ì‹¤í–‰
    if (message.channel.id !== CHANNEL_ID) return;
      // âœ… ì´ë¯¸ ì§ˆë¬¸ì´ ì§„í–‰ ì¤‘ì´ë©´(ë‹µë³€ ëŒ€ê¸° ì¤‘ì´ë©´) ìƒˆ ì§ˆë¬¸ ê¸ˆì§€
  if (activeQuestion) return;
    
    await postQuestion();
    return;
  }

  // ë‹µë³€ ìˆ˜ì§‘: ì§€ì •ëœ ì±„ë„ + ë‘ ì‚¬ëŒë§Œ + ì˜¤ëŠ˜ ì§ˆë¬¸ì´ ìˆì„ ë•Œë§Œ
  if (!activeQuestion) return;
  if (message.channel.id !== CHANNEL_ID) return;
  if (!USER_IDS.includes(message.author.id)) return;

  const content = (message.content || '').trim();
  if (!content) return;

  // ì´ë¯¸ ë‹µí•œ ì‚¬ëŒì€ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ (ë©”ì‹œì§€ëŠ” ìˆ¨ê¹€)
  if (activeQuestion.answers[message.author.id]) {
    await message.delete().catch(() => {});
    return;
  }

  // ë‹µ ì €ì¥
  activeQuestion.answers[message.author.id] = content;

  // ì±„ë„ì—ì„œ ë‹µë³€ ìˆ¨ê¸°ê¸°(ì‚­ì œ) -> ë‘˜ ë‹¤ ë‹µí•˜ê¸° ì „ê¹Œì§€ ì„œë¡œ ëª» ë´„
  await message.delete().catch(() => {});

  // ë‘˜ ë‹¤ ë‹µí–ˆìœ¼ë©´ ê³µê°œ
  const answeredCount = Object.keys(activeQuestion.answers).length;
  if (answeredCount === 2) {
    const channel = client.channels.cache.get(CHANNEL_ID);
    if (!channel) return;
    await revealAnswers(channel);
  }
});

client.login(process.env.TOKEN);

// í—¬ìŠ¤ì²´í¬ ì„œë²„
http.createServer((req, res) => res.end("Bot is running")).listen(3000);
































